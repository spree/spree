{"version":3,"sources":["../src/config.ts","../src/data/products.ts","../src/data/taxons.ts","../src/data/taxonomies.ts","../src/data/store.ts","../src/data/countries.ts","../src/cookies.ts","../src/actions/cart.ts","../src/actions/checkout.ts","../src/auth-helpers.ts","../src/actions/auth.ts","../src/actions/addresses.ts","../src/actions/orders.ts","../src/actions/credit-cards.ts","../src/actions/gift-cards.ts"],"names":["revalidateTag"],"mappings":"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","file":"index.js","sourcesContent":["import { createSpreeClient, type SpreeClient } from '@spree/sdk';\nimport type { SpreeNextConfig } from './types';\n\nlet _client: SpreeClient | null = null;\nlet _config: SpreeNextConfig | null = null;\n\n/**\n * Initialize the Spree Next.js integration.\n * Call this once in your app (e.g., in `lib/storefront.ts`).\n * If not called, the client will auto-initialize from SPREE_API_URL and SPREE_API_KEY env vars.\n */\nexport function initSpreeNext(config: SpreeNextConfig): void {\n  _config = config;\n  _client = createSpreeClient({\n    baseUrl: config.baseUrl,\n    apiKey: config.apiKey,\n  });\n}\n\n/**\n * Get the SpreeClient instance. Auto-initializes from env vars if needed.\n * @internal\n */\nexport function getClient(): SpreeClient {\n  if (!_client) {\n    const baseUrl = process.env.SPREE_API_URL;\n    const apiKey = process.env.SPREE_API_KEY;\n    if (baseUrl && apiKey) {\n      initSpreeNext({ baseUrl, apiKey });\n    } else {\n      throw new Error(\n        '@spree/next is not configured. Either call initSpreeNext() or set SPREE_API_URL and SPREE_API_KEY environment variables.'\n      );\n    }\n  }\n  return _client!;\n}\n\n/**\n * Get the current config. Auto-initializes from env vars if needed.\n * @internal\n */\nexport function getConfig(): SpreeNextConfig {\n  if (!_config) {\n    getClient(); // triggers auto-init\n  }\n  return _config!;\n}\n\n/**\n * Reset the client (useful for testing).\n * @internal\n */\nexport function resetClient(): void {\n  _client = null;\n  _config = null;\n}\n","import type { StoreProduct, PaginatedResponse, ProductFiltersResponse } from '@spree/sdk';\nimport { getClient } from '../config';\nimport type { SpreeNextOptions } from '../types';\n\n/**\n * List products with optional filtering, sorting, and pagination.\n */\nexport async function listProducts(\n  params?: Record<string, unknown>,\n  options?: SpreeNextOptions\n): Promise<PaginatedResponse<StoreProduct>> {\n  return getClient().products.list(params, {\n    locale: options?.locale,\n    currency: options?.currency,\n  });\n}\n\n/**\n * Get a single product by slug or ID.\n */\nexport async function getProduct(\n  slugOrId: string,\n  params?: { includes?: string },\n  options?: SpreeNextOptions\n): Promise<StoreProduct> {\n  return getClient().products.get(slugOrId, params, {\n    locale: options?.locale,\n    currency: options?.currency,\n  });\n}\n\n/**\n * Get available product filters (price ranges, option values, etc.).\n */\nexport async function getProductFilters(\n  params?: Record<string, unknown>,\n  options?: SpreeNextOptions\n): Promise<ProductFiltersResponse> {\n  return getClient().products.filters(params, {\n    locale: options?.locale,\n    currency: options?.currency,\n  });\n}\n","import type { StoreTaxon, StoreProduct, PaginatedResponse } from '@spree/sdk';\nimport { getClient } from '../config';\nimport type { SpreeNextOptions } from '../types';\n\n/**\n * List taxons (categories) with optional filtering and pagination.\n */\nexport async function listTaxons(\n  params?: Record<string, unknown>,\n  options?: SpreeNextOptions\n): Promise<PaginatedResponse<StoreTaxon>> {\n  return getClient().taxons.list(params, {\n    locale: options?.locale,\n    currency: options?.currency,\n  });\n}\n\n/**\n * Get a single taxon by ID or permalink.\n */\nexport async function getTaxon(\n  idOrPermalink: string,\n  params?: Record<string, unknown>,\n  options?: SpreeNextOptions\n): Promise<StoreTaxon> {\n  return getClient().taxons.get(idOrPermalink, params, {\n    locale: options?.locale,\n    currency: options?.currency,\n  });\n}\n\n/**\n * List products within a taxon.\n */\nexport async function listTaxonProducts(\n  taxonId: string,\n  params?: Record<string, unknown>,\n  options?: SpreeNextOptions\n): Promise<PaginatedResponse<StoreProduct>> {\n  return getClient().taxons.products.list(taxonId, params, {\n    locale: options?.locale,\n    currency: options?.currency,\n  });\n}\n","import type { StoreTaxonomy, PaginatedResponse } from '@spree/sdk';\nimport { getClient } from '../config';\nimport type { SpreeNextOptions } from '../types';\n\n/**\n * List taxonomies with optional filtering and pagination.\n */\nexport async function listTaxonomies(\n  params?: Record<string, unknown>,\n  options?: SpreeNextOptions\n): Promise<PaginatedResponse<StoreTaxonomy>> {\n  return getClient().taxonomies.list(params, {\n    locale: options?.locale,\n    currency: options?.currency,\n  });\n}\n\n/**\n * Get a single taxonomy by ID.\n */\nexport async function getTaxonomy(\n  id: string,\n  params?: Record<string, unknown>,\n  options?: SpreeNextOptions\n): Promise<StoreTaxonomy> {\n  return getClient().taxonomies.get(id, params, {\n    locale: options?.locale,\n    currency: options?.currency,\n  });\n}\n","import type { StoreStore } from '@spree/sdk';\nimport { getClient } from '../config';\nimport type { SpreeNextOptions } from '../types';\n\n/**\n * Get the current store configuration.\n */\nexport async function getStore(options?: SpreeNextOptions): Promise<StoreStore> {\n  return getClient().store.get({\n    locale: options?.locale,\n    currency: options?.currency,\n  });\n}\n","import type { StoreCountry } from '@spree/sdk';\nimport { getClient } from '../config';\nimport type { SpreeNextOptions } from '../types';\n\n/**\n * List all available countries.\n */\nexport async function listCountries(\n  options?: SpreeNextOptions\n): Promise<{ data: StoreCountry[] }> {\n  return getClient().countries.list({\n    locale: options?.locale,\n    currency: options?.currency,\n  });\n}\n\n/**\n * Get a single country by ISO code.\n */\nexport async function getCountry(\n  iso: string,\n  options?: SpreeNextOptions\n): Promise<StoreCountry> {\n  return getClient().countries.get(iso, {\n    locale: options?.locale,\n    currency: options?.currency,\n  });\n}\n","import { cookies } from 'next/headers';\nimport { getConfig } from './config';\n\nconst DEFAULT_CART_COOKIE = '_spree_cart_token';\nconst DEFAULT_ACCESS_TOKEN_COOKIE = '_spree_jwt';\nconst CART_TOKEN_MAX_AGE = 60 * 60 * 24 * 30; // 30 days\nconst ACCESS_TOKEN_MAX_AGE = 60 * 60 * 24 * 7; // 7 days\n\nfunction getCartCookieName(): string {\n  try {\n    return getConfig().cartCookieName ?? DEFAULT_CART_COOKIE;\n  } catch {\n    return DEFAULT_CART_COOKIE;\n  }\n}\n\nfunction getAccessTokenCookieName(): string {\n  try {\n    return getConfig().accessTokenCookieName ?? DEFAULT_ACCESS_TOKEN_COOKIE;\n  } catch {\n    return DEFAULT_ACCESS_TOKEN_COOKIE;\n  }\n}\n\n// --- Cart Token ---\n\nexport async function getCartToken(): Promise<string | undefined> {\n  const cookieStore = await cookies();\n  return cookieStore.get(getCartCookieName())?.value;\n}\n\nexport async function setCartToken(token: string): Promise<void> {\n  const cookieStore = await cookies();\n  cookieStore.set(getCartCookieName(), token, {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === 'production',\n    sameSite: 'lax',\n    path: '/',\n    maxAge: CART_TOKEN_MAX_AGE,\n  });\n}\n\nexport async function clearCartToken(): Promise<void> {\n  const cookieStore = await cookies();\n  cookieStore.set(getCartCookieName(), '', {\n    maxAge: -1,\n    path: '/',\n  });\n}\n\n// --- Access Token (JWT) ---\n\nexport async function getAccessToken(): Promise<string | undefined> {\n  const cookieStore = await cookies();\n  return cookieStore.get(getAccessTokenCookieName())?.value;\n}\n\nexport async function setAccessToken(token: string): Promise<void> {\n  const cookieStore = await cookies();\n  cookieStore.set(getAccessTokenCookieName(), token, {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === 'production',\n    sameSite: 'lax',\n    path: '/',\n    maxAge: ACCESS_TOKEN_MAX_AGE,\n  });\n}\n\nexport async function clearAccessToken(): Promise<void> {\n  const cookieStore = await cookies();\n  cookieStore.set(getAccessTokenCookieName(), '', {\n    maxAge: -1,\n    path: '/',\n  });\n}\n","'use server';\n\nimport { revalidateTag } from 'next/cache';\nimport type { StoreOrder, StoreLineItem } from '@spree/sdk';\nimport { getClient } from '../config';\nimport { getCartToken, setCartToken, clearCartToken, getAccessToken } from '../cookies';\n\n/**\n * Get the current cart. Returns null if no cart exists.\n */\nexport async function getCart(): Promise<(StoreOrder & { token: string }) | null> {\n  const orderToken = await getCartToken();\n  const token = await getAccessToken();\n  if (!orderToken && !token) return null;\n\n  try {\n    return await getClient().cart.get({ orderToken, token });\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Get existing cart or create a new one.\n */\nexport async function getOrCreateCart(): Promise<StoreOrder & { token: string }> {\n  const existing = await getCart();\n  if (existing) return existing;\n\n  const token = await getAccessToken();\n  const cart = await getClient().cart.create(token ? { token } : undefined);\n\n  if (cart.token) {\n    await setCartToken(cart.token);\n  }\n\n  revalidateTag('cart');\n  return cart;\n}\n\n/**\n * Add an item to the cart. Creates a cart if none exists.\n */\nexport async function addItem(\n  variantId: string,\n  quantity: number = 1\n): Promise<StoreLineItem> {\n  const cart = await getOrCreateCart();\n  const orderToken = cart.token;\n  const token = await getAccessToken();\n\n  const lineItem = await getClient().orders.lineItems.create(\n    cart.id,\n    { variant_id: variantId, quantity },\n    { orderToken, token }\n  );\n\n  revalidateTag('cart');\n  return lineItem;\n}\n\n/**\n * Update a line item quantity in the cart.\n */\nexport async function updateItem(\n  lineItemId: string,\n  quantity: number\n): Promise<StoreLineItem> {\n  const orderToken = await getCartToken();\n  const token = await getAccessToken();\n  if (!orderToken && !token) throw new Error('No cart found');\n\n  const cart = await getClient().cart.get({ orderToken, token });\n\n  const lineItem = await getClient().orders.lineItems.update(\n    cart.id,\n    lineItemId,\n    { quantity },\n    { orderToken, token }\n  );\n\n  revalidateTag('cart');\n  return lineItem;\n}\n\n/**\n * Remove a line item from the cart.\n */\nexport async function removeItem(lineItemId: string): Promise<void> {\n  const orderToken = await getCartToken();\n  const token = await getAccessToken();\n  if (!orderToken && !token) throw new Error('No cart found');\n\n  const cart = await getClient().cart.get({ orderToken, token });\n\n  await getClient().orders.lineItems.delete(cart.id, lineItemId, {\n    orderToken,\n    token,\n  });\n\n  revalidateTag('cart');\n}\n\n/**\n * Clear the cart (abandons the current cart).\n */\nexport async function clearCart(): Promise<void> {\n  await clearCartToken();\n  revalidateTag('cart');\n}\n\n/**\n * Associate a guest cart with the currently authenticated user.\n * Call this after login/register when the user has an existing guest cart.\n */\nexport async function associateCart(): Promise<(StoreOrder & { token: string }) | null> {\n  const orderToken = await getCartToken();\n  const token = await getAccessToken();\n  if (!orderToken || !token) return null;\n\n  try {\n    const result = await getClient().cart.associate({ orderToken, token });\n    revalidateTag('cart');\n    return result;\n  } catch {\n    // Cart might already belong to another user — clear it\n    await clearCartToken();\n    revalidateTag('cart');\n    return null;\n  }\n}\n","'use server';\n\nimport { revalidateTag } from 'next/cache';\nimport type { StoreOrder, StoreShipment, AddressParams } from '@spree/sdk';\nimport { getClient } from '../config';\nimport { getCartToken, getAccessToken } from '../cookies';\n\nasync function getCheckoutOptions() {\n  const orderToken = await getCartToken();\n  const token = await getAccessToken();\n  return { orderToken, token };\n}\n\n/**\n * Get the current checkout order state.\n */\nexport async function getCheckout(\n  orderId: string\n): Promise<StoreOrder> {\n  const options = await getCheckoutOptions();\n  return getClient().orders.get(orderId, undefined, options);\n}\n\n/**\n * Update shipping and/or billing addresses on the order.\n */\nexport async function updateAddresses(\n  orderId: string,\n  params: {\n    email?: string;\n    ship_address?: AddressParams;\n    bill_address?: AddressParams;\n    ship_address_id?: string;\n    bill_address_id?: string;\n  }\n): Promise<StoreOrder> {\n  const options = await getCheckoutOptions();\n  const result = await getClient().orders.update(orderId, params, options);\n  revalidateTag('checkout');\n  return result;\n}\n\n/**\n * Advance the checkout to the next step.\n */\nexport async function advance(orderId: string): Promise<StoreOrder> {\n  const options = await getCheckoutOptions();\n  const result = await getClient().orders.advance(orderId, options);\n  revalidateTag('checkout');\n  return result;\n}\n\n/**\n * Move the checkout to the next step (alias for advance).\n */\nexport async function next(orderId: string): Promise<StoreOrder> {\n  const options = await getCheckoutOptions();\n  const result = await getClient().orders.next(orderId, options);\n  revalidateTag('checkout');\n  return result;\n}\n\n/**\n * Get shipments for the order (includes available shipping rates).\n */\nexport async function getShipments(\n  orderId: string\n): Promise<{ data: StoreShipment[] }> {\n  const options = await getCheckoutOptions();\n  return getClient().orders.shipments.list(orderId, options);\n}\n\n/**\n * Select a shipping rate for a shipment.\n */\nexport async function selectShippingRate(\n  orderId: string,\n  shipmentId: string,\n  shippingRateId: string\n): Promise<StoreShipment> {\n  const options = await getCheckoutOptions();\n  const result = await getClient().orders.shipments.update(\n    orderId,\n    shipmentId,\n    { selected_shipping_rate_id: shippingRateId },\n    options\n  );\n  revalidateTag('checkout');\n  return result;\n}\n\n/**\n * Apply a coupon code to the order.\n */\nexport async function applyCoupon(\n  orderId: string,\n  code: string\n): Promise<StoreOrder> {\n  const options = await getCheckoutOptions();\n  const result = await getClient().orders.couponCodes.apply(orderId, code, options);\n  revalidateTag('checkout');\n  revalidateTag('cart');\n  return result;\n}\n\n/**\n * Remove a coupon/promotion from the order.\n */\nexport async function removeCoupon(\n  orderId: string,\n  promotionId: string\n): Promise<StoreOrder> {\n  const options = await getCheckoutOptions();\n  const result = await getClient().orders.couponCodes.remove(orderId, promotionId, options);\n  revalidateTag('checkout');\n  revalidateTag('cart');\n  return result;\n}\n\n/**\n * Complete the checkout and place the order.\n */\nexport async function complete(orderId: string): Promise<StoreOrder> {\n  const options = await getCheckoutOptions();\n  const result = await getClient().orders.complete(orderId, options);\n  revalidateTag('checkout');\n  revalidateTag('cart');\n  return result;\n}\n","import { SpreeError } from '@spree/sdk';\nimport type { RequestOptions } from '@spree/sdk';\nimport { getClient } from './config';\nimport { getAccessToken, setAccessToken, clearAccessToken } from './cookies';\n\n/**\n * Get auth request options from the current JWT token.\n * Proactively refreshes the token if it expires within 1 hour.\n */\nexport async function getAuthOptions(): Promise<RequestOptions> {\n  const token = await getAccessToken();\n  if (!token) {\n    return {};\n  }\n\n  // Check if token is close to expiry by decoding JWT payload\n  try {\n    const payload = JSON.parse(atob(token.split('.')[1]));\n    const exp = payload.exp;\n    const now = Math.floor(Date.now() / 1000);\n\n    // Refresh if token expires in less than 1 hour\n    if (exp && exp - now < 3600) {\n      try {\n        const refreshed = await getClient().auth.refresh({ token });\n        await setAccessToken(refreshed.token);\n        return { token: refreshed.token };\n      } catch {\n        // Refresh failed — use existing token, it might still work\n      }\n    }\n  } catch {\n    // Can't decode JWT — use it as-is, the server will reject if invalid\n  }\n\n  return { token };\n}\n\n/**\n * Execute an authenticated request with automatic token refresh on 401.\n * @param fn - Function that takes RequestOptions and returns a promise\n * @returns The result of the function\n * @throws SpreeError if auth fails after refresh attempt\n */\nexport async function withAuthRefresh<T>(\n  fn: (options: RequestOptions) => Promise<T>\n): Promise<T> {\n  const options = await getAuthOptions();\n\n  if (!options.token) {\n    throw new Error('Not authenticated');\n  }\n\n  try {\n    return await fn(options);\n  } catch (error: unknown) {\n    // If 401, try refreshing the token once\n    if (error instanceof SpreeError && error.status === 401) {\n      try {\n        const refreshed = await getClient().auth.refresh({ token: options.token });\n        await setAccessToken(refreshed.token);\n        return await fn({ token: refreshed.token });\n      } catch {\n        // Refresh failed — clear token and rethrow\n        await clearAccessToken();\n        throw error;\n      }\n    }\n    throw error;\n  }\n}\n","'use server';\n\nimport { revalidateTag } from 'next/cache';\nimport type { StoreUser } from '@spree/sdk';\nimport { getClient } from '../config';\nimport { setAccessToken, clearAccessToken, getAccessToken, getCartToken } from '../cookies';\nimport { withAuthRefresh } from '../auth-helpers';\n\n/**\n * Login with email and password.\n * Automatically associates any guest cart with the authenticated user.\n */\nexport async function login(\n  email: string,\n  password: string\n): Promise<{ success: boolean; user?: { id: string; email: string; first_name?: string | null; last_name?: string | null }; error?: string }> {\n  try {\n    const result = await getClient().auth.login({ email, password });\n    await setAccessToken(result.token);\n\n    // Associate guest cart if one exists\n    const cartToken = await getCartToken();\n    if (cartToken) {\n      try {\n        await getClient().cart.associate({\n          token: result.token,\n          orderToken: cartToken,\n        });\n      } catch {\n        // Cart association failure is non-fatal\n      }\n    }\n\n    revalidateTag('customer');\n    revalidateTag('cart');\n    return { success: true, user: result.user };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Invalid email or password',\n    };\n  }\n}\n\n/**\n * Register a new customer account.\n * Automatically associates any guest cart with the new account.\n */\nexport async function register(\n  email: string,\n  password: string,\n  passwordConfirmation: string\n): Promise<{ success: boolean; user?: { id: string; email: string; first_name?: string | null; last_name?: string | null }; error?: string }> {\n  try {\n    const result = await getClient().auth.register({\n      email,\n      password,\n      password_confirmation: passwordConfirmation,\n    });\n    await setAccessToken(result.token);\n\n    // Associate guest cart\n    const cartToken = await getCartToken();\n    if (cartToken) {\n      try {\n        await getClient().cart.associate({\n          token: result.token,\n          orderToken: cartToken,\n        });\n      } catch {\n        // Non-fatal\n      }\n    }\n\n    revalidateTag('customer');\n    revalidateTag('cart');\n    return { success: true, user: result.user };\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Registration failed',\n    };\n  }\n}\n\n/**\n * Logout the current user.\n */\nexport async function logout(): Promise<void> {\n  await clearAccessToken();\n  revalidateTag('customer');\n  revalidateTag('cart');\n  revalidateTag('addresses');\n  revalidateTag('credit-cards');\n}\n\n/**\n * Get the currently authenticated customer. Returns null if not logged in.\n */\nexport async function getCustomer(): Promise<StoreUser | null> {\n  const token = await getAccessToken();\n  if (!token) return null;\n\n  try {\n    return await withAuthRefresh(async (options) => {\n      return getClient().customer.get(options);\n    });\n  } catch {\n    await clearAccessToken();\n    return null;\n  }\n}\n\n/**\n * Update the current customer's profile.\n */\nexport async function updateCustomer(\n  data: { first_name?: string; last_name?: string; email?: string }\n): Promise<StoreUser> {\n  const result = await withAuthRefresh(async (options) => {\n    return getClient().customer.update(data, options);\n  });\n  revalidateTag('customer');\n  return result;\n}\n","'use server';\n\nimport { revalidateTag } from 'next/cache';\nimport type { StoreAddress, AddressParams } from '@spree/sdk';\nimport { withAuthRefresh } from '../auth-helpers';\nimport { getClient } from '../config';\n\n/**\n * List the authenticated customer's addresses.\n */\nexport async function listAddresses(): Promise<{ data: StoreAddress[] }> {\n  return withAuthRefresh(async (options) => {\n    return getClient().customer.addresses.list(undefined, options);\n  });\n}\n\n/**\n * Get a single address by ID.\n */\nexport async function getAddress(id: string): Promise<StoreAddress> {\n  return withAuthRefresh(async (options) => {\n    return getClient().customer.addresses.get(id, options);\n  });\n}\n\n/**\n * Create a new address for the customer.\n */\nexport async function createAddress(params: AddressParams): Promise<StoreAddress> {\n  const result = await withAuthRefresh(async (options) => {\n    return getClient().customer.addresses.create(params, options);\n  });\n  revalidateTag('addresses');\n  return result;\n}\n\n/**\n * Update an existing address.\n */\nexport async function updateAddress(\n  id: string,\n  params: Partial<AddressParams>\n): Promise<StoreAddress> {\n  const result = await withAuthRefresh(async (options) => {\n    return getClient().customer.addresses.update(id, params, options);\n  });\n  revalidateTag('addresses');\n  return result;\n}\n\n/**\n * Delete an address.\n */\nexport async function deleteAddress(id: string): Promise<void> {\n  await withAuthRefresh(async (options) => {\n    return getClient().customer.addresses.delete(id, options);\n  });\n  revalidateTag('addresses');\n}\n","'use server';\n\nimport type { StoreOrder, PaginatedResponse } from '@spree/sdk';\nimport { withAuthRefresh } from '../auth-helpers';\nimport { getClient } from '../config';\n\n/**\n * List the authenticated customer's orders.\n */\nexport async function listOrders(\n  params?: Record<string, unknown>\n): Promise<PaginatedResponse<StoreOrder>> {\n  return withAuthRefresh(async (options) => {\n    return getClient().orders.list(params, options);\n  });\n}\n\n/**\n * Get a single order by ID or number.\n */\nexport async function getOrder(\n  idOrNumber: string,\n  params?: Record<string, unknown>\n): Promise<StoreOrder> {\n  return withAuthRefresh(async (options) => {\n    return getClient().orders.get(idOrNumber, params, options);\n  });\n}\n","'use server';\n\nimport { revalidateTag } from 'next/cache';\nimport type { StoreCreditCard } from '@spree/sdk';\nimport { withAuthRefresh } from '../auth-helpers';\nimport { getClient } from '../config';\n\n/**\n * List the authenticated customer's credit cards.\n */\nexport async function listCreditCards(): Promise<{ data: StoreCreditCard[] }> {\n  return withAuthRefresh(async (options) => {\n    return getClient().customer.creditCards.list(undefined, options);\n  });\n}\n\n/**\n * Delete a credit card.\n */\nexport async function deleteCreditCard(id: string): Promise<void> {\n  await withAuthRefresh(async (options) => {\n    return getClient().customer.creditCards.delete(id, options);\n  });\n  revalidateTag('credit-cards');\n}\n","'use server';\n\nimport type { StoreGiftCard } from '@spree/sdk';\nimport { withAuthRefresh } from '../auth-helpers';\nimport { getClient } from '../config';\n\n/**\n * List the authenticated customer's gift cards.\n */\nexport async function listGiftCards(): Promise<{ data: StoreGiftCard[] }> {\n  return withAuthRefresh(async (options) => {\n    return getClient().customer.giftCards.list(undefined, options);\n  });\n}\n\n/**\n * Get a single gift card by ID.\n */\nexport async function getGiftCard(id: string): Promise<StoreGiftCard> {\n  return withAuthRefresh(async (options) => {\n    return getClient().customer.giftCards.get(id, options);\n  });\n}\n"]}