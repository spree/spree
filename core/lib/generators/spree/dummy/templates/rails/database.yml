<%# Database configuration that reads from environment variables at runtime %>
<%# This allows the same database.yml to work across different modules %>

<% lib_name = ENV.fetch('LIB_NAME', 'spree').gsub('/', '_') %>

development:
  adapter: sqlite3
  database: db/spree_development.sqlite3

test:
  adapter: <%= ENV.fetch('DB', 'sqlite3') == 'postgres' ? 'postgresql' : (ENV.fetch('DB', 'sqlite3') == 'mysql' ? 'mysql2' : 'sqlite3') %>
  database: <%= ENV.fetch('DB', 'sqlite3') == 'sqlite3' ? 'db/spree_test.sqlite3' : "#{lib_name}_spree_test" %>
  <% if ENV['DB'] == 'postgres' || ENV['DB'] == 'mysql' %>
  username: <%= ENV['DB_USERNAME'] %>
  <% if ENV['DB_PASSWORD'] && !ENV['DB_PASSWORD'].empty? %>
  password: <%= ENV['DB_PASSWORD'] %>
  <% end %>
  <% if ENV['DB_HOST'] && !ENV['DB_HOST'].empty? %>
  host: <%= ENV['DB_HOST'] %>
  <% end %>
  pool: <%= ENV.fetch('DB_POOL', 50) %>
  <% end %>
  <% if ENV['DB'] == 'mysql' %>
  encoding: utf8
  reconnect: true
  <% end %>
  <% if ENV['DB'] == 'postgres' %>
  min_messages: warning
  <% end %>

production:
  adapter: sqlite3
  database: db/spree_production.sqlite3