<%# locals: (record_list:, list_key:, selected_columns:) %>
<div data-controller="column-selector">
  <%= form_with url: spree.admin_record_list_columns_path,
                method: :post,
                data: { turbo_frame: '_top' } do |f| %>
    <%= hidden_field_tag :list_key, list_key %>

    <%= dropdown(portal: false) do %>
      <%= dropdown_toggle(class: 'btn-light btn-sm flex items-center gap-1') do %>
        <%= icon 'columns-3', class: 'w-4 h-4' %>
        <span><%= Spree.t('admin.record_lists.columns') %></span>
        <%= icon 'chevron-down', class: 'w-3 h-3' %>
      <% end %>

      <%= dropdown_menu(class: 'min-w-[250px] p-4') do %>
        <div class="mb-3">
          <h6 class="font-semibold text-gray-700 text-sm">
            <%= Spree.t('admin.record_lists.visible_columns') %>
          </h6>
        </div>

        <div class="space-y-2 max-h-[300px] overflow-y-auto mb-4">
          <% record_list.available_columns.each do |column| %>
            <% next unless column.visible?(self) %>
            <% is_selected = selected_columns.nil? ? column.default? : selected_columns.include?(column.key) %>
            <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-1.5 rounded">
              <%= check_box_tag 'columns[]',
                                column.key,
                                is_selected,
                                id: "column_#{column.key}",
                                data: {
                                  column_selector_target: 'checkbox',
                                  default: column.default?
                                },
                                class: 'form-checkbox rounded' %>
              <span class="text-sm text-gray-700"><%= column.resolve_label %></span>
            </label>
          <% end %>
        </div>

        <div class="flex gap-2 pt-3 border-t border-gray-200">
          <button type="button"
                  class="btn btn-sm btn-light flex-1"
                  data-action="column-selector#reset">
            <%= Spree.t('admin.record_lists.reset_to_default') %>
          </button>
          <%= f.submit Spree.t('admin.record_lists.apply'),
                       class: 'btn btn-sm btn-primary flex-1 cursor-pointer' %>
        </div>
      <% end %>
    <% end %>
  <% end %>
</div>
