<%= turbo_frame_tag :dialog_modal do %>
  <%= form_with model: @promotion_action, url: spree.admin_promotion_actions_path(@promotion), method: :post, scope: :promotion_action do |f| %>
    <div class="modal-content" data-controller="search-picker">
      <div class="modal-header">
        <h5 class="modal-title">
          <% if @promotion_action.type.nil? %>
            <%= Spree.t(:add_action_of_type) %>
          <% else %>
            <%= @promotion_action.human_name %>
          <% end %>
        </h5>
        <button type="button" class="btn-close" data-dismiss="modal" aria-label="<%= Spree.t(:close) %>" />
      </div>
      <div class="modal-body border-bottom pb-3">
        <% if @promotion_action.type.nil? %>
          <ul class="list-group">
            <% allowed_action_types.each do |action_type| %>
              <% key = action_type.to_s.demodulize.underscore %>
              <li class="list-group-item p-0">
                <%= link_to spree.new_admin_promotion_action_path(@promotion, promotion_action: { type: action_type }), class: 'd-flex align-items-top w-100 p-3 hover-light', data: { turbo_prefetch: false } do %>
                  <%= radio_button_tag :type, action_type, checked: @promotion_action.type == action_type %>
                  <div class="ml-3">
                    <h6><%= Spree.t("promotion_action_types.#{key}.name") %></h6>
                    <p class="text-muted mb-0"><%= Spree.t("promotion_action_types.#{key}.description") %></p>
                  </div>
                <% end %>
              </li>
            <% end %>
          </ul>
        <% else %>
          <p class="text-muted">
            <%= @promotion_action.human_description %>
          </p>
          <%= f.hidden_field :type, value: @promotion_action.type %>
          <%= render "spree/admin/promotion_actions/forms/#{@promotion_action.key}", f: f %>
        <% end %>
      </div>
      <% if @promotion_action.type.present? %>
        <div class="modal-footer d-flex justify-content-between">
          <button type="button" class="btn btn-light" data-dismiss="modal"><%= Spree.t('actions.discard') %></button>
          <%= turbo_save_button_tag Spree.t('actions.create'), data: { turbo_frame: '_top' } %>
        </div>
      <% end %>
    </div>
  <% end %>
<% end %>