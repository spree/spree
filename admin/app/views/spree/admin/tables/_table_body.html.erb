<%# locals: (collection:, columns:, table:, bulk_operations: false, sortable: false) %>
<% has_bulk_actions = bulk_operations && table.bulk_operations_enabled? %>
<% has_row_actions = table.row_actions? %>
<% if has_bulk_actions %>
  <div data-controller="bulk-operation bulk-dialog" data-action="keydown.esc->bulk-operation#cancel" tabindex="0">
    <%= form_tag url_for(action: :index), method: :put, data: { 'bulk-operation-target': 'form' } do %>
      <%= render 'spree/admin/shared/bulk_modal' %>
      <%= render_bulk_actions_panel(table) %>

      <div class="table-responsive">
        <table class="table" id="listing_<%= controller_name %>">
          <thead>
            <tr>
              <% if sortable %>
                <th scope="col" class="w-5 rounded-none"></th>
              <% end %>

              <th scope="col" class="pr-0 w-5 rounded-none">
                <%= bulk_operations_select_all_checkbox %>
              </th>

              <% columns.each do |column| %>
                <th class="rounded-none" scope="col" class="<%= column_header_class(column) %>">
                  <%= column.resolve_label %>
                </th>
              <% end %>

              <% if has_row_actions %>
                <th scope="col" class="w-10 rounded-none"></th>
              <% end %>
            </tr>
          </thead>
          <tbody
            <% if sortable %>
              data-controller="sortable"
              data-sortable-handle-value=".move-handle"
              data-sortable-resource-name-value="<%= controller_name.singularize %>"
              data-sortable-response-kind-value="turbo-stream"
            <% end %>
          >
            <%= render partial: 'spree/admin/tables/table_row',
                       collection: collection,
                       as: :record,
                       locals: {
                         columns: columns,
                         table: table,
                         bulk_operations: has_bulk_actions,
                         sortable: sortable,
                         row_actions: has_row_actions
                       } %>
          </tbody>
        </table>
      </div>
    <% end %>
  </div>
<% else %>
  <div class="table-responsive">
    <table class="table" id="listing_<%= controller_name %>">
      <thead>
        <tr>
          <% if sortable %>
            <th scope="col" class="w-5 rounded-none"></th>
          <% end %>

          <% columns.each do |column| %>
            <th class="rounded-none" scope="col" class="<%= column_header_class(column) %>">
              <%= column.resolve_label %>
            </th>
          <% end %>

          <% if has_row_actions %>
            <th scope="col" class="w-10 rounded-none"></th>
          <% end %>
        </tr>
      </thead>
      <tbody
        <% if sortable %>
          data-controller="sortable"
          data-sortable-handle-value=".move-handle"
          data-sortable-resource-name-value="<%= controller_name.singularize %>"
          data-sortable-response-kind-value="turbo-stream"
        <% end %>
      >
        <%= render partial: 'spree/admin/tables/table_row',
                   collection: collection,
                   as: :record,
                   locals: {
                     columns: columns,
                     table: table,
                     bulk_operations: false,
                     sortable: sortable,
                     row_actions: has_row_actions
                   } %>
      </tbody>
    </table>
  </div>
<% end %>
