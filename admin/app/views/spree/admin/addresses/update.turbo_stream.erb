<% @user = @address.user %>

<% if @address.valid? %>
  <%= turbo_render_alerts %>

  <%= turbo_stream.replace 'user-ship-address' do %>
    <%= render 'spree/admin/users/shipping' %>
  <% end %>

  <%= turbo_stream.replace 'user-bill-address' do %>
    <%= render 'spree/admin/users/billing' %>
  <% end %>
<% else %>
  <%# Update service may return a new address without ID when original isn't editable %>
  <%= turbo_stream.replace "edit_address_#{params[:type]}" do %>
    <% if @address.persisted? %>
      <%= render 'spree/admin/addresses/edit_form' %>
    <% else %>
      <%= render 'spree/admin/addresses/new_form',
            frame_id: "edit_address_#{params[:type]}",
            user_id: @user.id,
            default_shipping: params[:type] == 'shipping',
            default_billing: params[:type] == 'billing' %>
    <% end %>
  <% end %>
<% end %>
