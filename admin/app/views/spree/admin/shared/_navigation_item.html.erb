<%
  # Resolve item properties (pass self as context for route helpers)
  item_url = item.resolve_url(self)
  item_label = item.resolve_label
  badge_value = item.badge_value(self)
  is_active = item.active?(request.path, self)
  has_children = item.children.present?
  tooltip_text = item.tooltip

  # Build complete label with badge (like old menu pattern)
  complete_label = item_label
  if badge_value.present?
    badge_class = item.badge_class.presence || 'badge-light'
    complete_label += content_tag(:span, badge_value, class: "badge ml-auto #{badge_class}")
  end
  complete_label = complete_label.html_safe
%>

<% if item.section? %>
  <%# Section header %>
  <li class="nav-item nav-section-header mt-3">
    <span class="text-muted text-uppercase small"><%= item.section_label %></span>
  </li>
<% else %>
  <% if has_children %>
    <%# Item with children (submenu shows when parent is active) %>
    <% if tooltip_text.present? %>
      <%= nav_item(complete_label + tooltip(tooltip_text), item_url, icon: item.icon, active: is_active, data: { controller: 'tooltip' }) %>
    <% else %>
      <%= nav_item(complete_label, item_url, icon: item.icon, active: is_active, data: { controller: 'tooltip' }) %>
    <% end %>
    <% if is_active %>
      <ul class="nav-submenu">
        <% item.children.select { |child| child.visible?(self) }.each do |child_item| %>
          <%= render 'spree/admin/shared/navigation_item', item: child_item, context: context %>
        <% end %>
      </ul>
    <% end %>
  <% else %>
    <%# Regular item without children %>
    <% if tooltip_text.present? %>
      <%= nav_item(complete_label + tooltip(tooltip_text), item_url, icon: item.icon, active: is_active, data: { controller: 'tooltip' }) %>
    <% else %>
      <%= nav_item(complete_label, item_url, icon: item.icon, active: is_active, data: { controller: 'tooltip' }) %>
    <% end %>
  <% end %>
<% end %>
