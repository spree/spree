---
title: Turbo and Hotwire Patterns
sidebarTitle: Turbo Patterns
---

Spree Admin leverages Hotwire (Turbo and Stimulus) to provide a modern, fast, and responsive user experience without writing much JavaScript. This guide covers common Turbo patterns used throughout the admin interface.

## Overview

**Hotwire** consists of two main components:
- **Turbo** - Handles navigation, form submissions, and partial page updates
- **Stimulus** - Adds JavaScript behavior to HTML elements

Spree Admin uses both extensively to create a smooth, SPA-like experience while keeping the codebase simple and maintainable.

## Turbo Drive

### Basic Configuration

Turbo Drive is enabled by default in Spree Admin and handles all link clicks and form submissions via AJAX.

**Benefits:**
- Faster page transitions (no full page reload)
- Preserves scroll position
- Browser history management
- Progress bar during navigation

### Disabling Turbo Drive

For specific links or forms, you can disable Turbo:

```erb
<!-- Disable for a single link -->
<%= link_to 'External Site', 'https://example.com', data: { turbo: false } %>

<!-- Disable for entire form -->
<%= form_with url: admin_export_path, data: { turbo: false } do |f| %>
  <%= f.submit 'Export' %>
<% end %>

<!-- Disable for section of page -->
<div data-turbo="false">
  <!-- All links and forms here will use traditional navigation -->
</div>
```

**When to disable Turbo:**
- External links
- File downloads
- Full page redirects required
- JavaScript that doesn't play well with Turbo

### Turbo Drive Events

Listen to Turbo events for custom behavior:

```javascript
// app/javascript/application.js
document.addEventListener('turbo:load', () => {
  console.log('Page loaded via Turbo')
})

document.addEventListener('turbo:before-cache', () => {
  // Clean up before page is cached
  // E.g., reset form states, close modals
})

document.addEventListener('turbo:before-visit', (event) => {
  // Called before navigation
  // Can cancel: event.preventDefault()
})

document.addEventListener('turbo:visit', (event) => {
  console.log('Navigating to:', event.detail.url)
})
```

## Turbo Frames

Turbo Frames allow you to update specific parts of the page without a full reload.

### Basic Turbo Frame

```erb
<!-- Index view -->
<h1><%= Spree.t(:brands) %></h1>

<%= turbo_frame_tag 'brands_list' do %>
  <%= render @brands %>
  <%= paginate @brands %>
<% end %>
```

When a link inside the frame is clicked, only the frame content is updated:

```erb
<!-- _brand.html.erb partial -->
<div class="brand">
  <%= link_to brand.name, admin_brand_path(brand) %>
</div>
```

### Inline Editing with Frames

Edit a resource inline without leaving the index page:

```erb
<!-- Index view - app/views/spree/admin/brands/index.html.erb -->
<table class="table">
  <tbody>
    <% @brands.each do |brand| %>
      <%= turbo_frame_tag dom_id(brand) do %>
        <tr>
          <td><%= brand.name %></td>
          <td>
            <%= link_to Spree.t(:edit),
                edit_admin_brand_path(brand),
                class: 'btn btn-sm btn-secondary' %>
          </td>
        </tr>
      <% end %>
    <% end %>
  </tbody>
</table>
```

```erb
<!-- Edit view - app/views/spree/admin/brands/edit.html.erb -->
<%= turbo_frame_tag dom_id(@brand) do %>
  <%= form_with model: [:admin, @brand] do |f| %>
    <tr>
      <td><%= f.text_field :name, class: 'form-control' %></td>
      <td>
        <%= f.submit Spree.t(:save), class: 'btn btn-sm btn-primary' %>
        <%= link_to Spree.t(:cancel),
            admin_brands_path,
            class: 'btn btn-sm btn-secondary' %>
      </td>
    </tr>
  <% end %>
<% end %>
```

**How it works:**
1. Click "Edit" link inside frame
2. Turbo fetches edit page
3. Replaces frame content with matching frame from edit page
4. Submit form
5. Frame replaced with updated content

### Lazy Loading Frames

Load expensive content only when needed:

```erb
<%= turbo_frame_tag 'analytics',
    src: analytics_admin_dashboard_path,
    loading: :lazy do %>
  <div class="spinner">
    <%= Spree.t(:loading) %>...
  </div>
<% end %>
```

**Loading strategies:**
- `eager` - Load immediately (default)
- `lazy` - Load when frame becomes visible

### Frame Targeting

Navigate from one frame to another:

```erb
<!-- Frame A -->
<%= turbo_frame_tag 'product_list' do %>
  <%= link_to 'View Details',
      admin_product_path(@product),
      data: { turbo_frame: 'product_details' } %>
<% end %>

<!-- Frame B -->
<%= turbo_frame_tag 'product_details' do %>
  <!-- Details will load here -->
<% end %>
```

**Special targets:**
- `_top` - Navigate the entire page
- `_self` - Default, navigate the current frame
- `frame_id` - Navigate to specific frame

### Breaking Out of Frames

To navigate the entire page from within a frame:

```erb
<%= turbo_frame_tag 'modal' do %>
  <%= form_with model: [:admin, @brand] do |f| %>
    <%= f.text_field :name %>
    <%= f.submit 'Save', data: { turbo_frame: '_top' } %>
  <% end %>
<% end %>
```

## Turbo Streams

Turbo Streams allow multiple, simultaneous page updates in response to a single request.

### Basic Turbo Stream Response

```ruby
# Controller
def create
  @brand = Spree::Brand.new(permitted_params)

  if @brand.save
    respond_to do |format|
      format.turbo_stream
      format.html { redirect_to admin_brands_path }
    end
  else
    render :new, status: :unprocessable_entity
  end
end
```

```erb
<!-- create.turbo_stream.erb -->
<%= turbo_stream.prepend 'brands_list', @brand %>
<%= turbo_stream.update 'flash_messages' do %>
  <div class="alert alert-success">
    <%= Spree.t(:brand_created) %>
  </div>
<% end %>
```

### Turbo Stream Actions

**append** - Add content to end of target:
```erb
<%= turbo_stream.append 'brands_list', @brand %>
```

**prepend** - Add content to beginning of target:
```erb
<%= turbo_stream.prepend 'brands_list', @brand %>
```

**replace** - Replace entire target element:
```erb
<%= turbo_stream.replace dom_id(@brand), @brand %>
```

**update** - Replace content inside target:
```erb
<%= turbo_stream.update dom_id(@brand) do %>
  <td><%= @brand.name %></td>
<% end %>
```

**remove** - Remove target element:
```erb
<%= turbo_stream.remove dom_id(@brand) %>
```

**before** - Insert before target:
```erb
<%= turbo_stream.before 'brand_form', partial: 'help_text' %>
```

**after** - Insert after target:
```erb
<%= turbo_stream.after 'brand_form', partial: 'help_text' %>
```

### Multiple Updates

Update multiple parts of the page in one response:

```erb
<!-- update.turbo_stream.erb -->
<%= turbo_stream.replace dom_id(@brand), @brand %>

<%= turbo_stream.update 'brands_count' do %>
  <%= Spree::Brand.count %>
<% end %>

<%= turbo_stream.update 'flash_messages' do %>
  <div class="alert alert-success">
    <%= Spree.t(:brand_updated) %>
  </div>
<% end %>

<%= turbo_stream.replace 'sidebar_stats' do %>
  <%= render 'admin/shared/sidebar_stats' %>
<% end %>
```

### Broadcasting Turbo Streams

Real-time updates using Action Cable:

```ruby
# Model
class Brand < Spree.base_class
  after_create_commit -> { broadcast_prepend_to 'brands' }
  after_update_commit -> { broadcast_replace_to 'brands' }
  after_destroy_commit -> { broadcast_remove_to 'brands' }
end
```

```erb
<!-- View -->
<%= turbo_stream_from 'brands' %>

<div id="brands_list">
  <%= render @brands %>
</div>
```

Now any changes from other users will update in real-time!

## Form Patterns

### Standard Form Submission

Forms automatically use Turbo:

```erb
<%= form_with model: [:admin, @brand] do |f| %>
  <%= f.text_field :name %>
  <%= f.submit 'Save' %>
<% end %>
```

**On success:** Redirects via Turbo Drive
**On error:** Re-renders form with errors

### Form with Turbo Frame

Keep form validation inline:

```erb
<%= turbo_frame_tag 'brand_form' do %>
  <%= form_with model: [:admin, @brand] do |f| %>
    <%= render 'form', f: f %>
  <% end %>
<% end %>
```

```ruby
# Controller
def create
  @brand = Spree::Brand.new(permitted_params)

  if @brand.save
    redirect_to admin_brands_path
  else
    render :new, status: :unprocessable_entity
  end
end
```

The form stays in place and shows errors without navigation.

### Form with Turbo Stream

For more complex updates:

```erb
<%= form_with model: [:admin, @brand] do |f| %>
  <%= f.text_field :name %>
  <%= f.submit 'Save' %>
<% end %>
```

```ruby
# Controller
def create
  @brand = Spree::Brand.new(permitted_params)

  respond_to do |format|
    if @brand.save
      format.turbo_stream do
        render turbo_stream: [
          turbo_stream.prepend('brands_list', @brand),
          turbo_stream.update('brand_form', ''),
          turbo_stream.update('flash_messages', partial: 'shared/success')
        ]
      end
    else
      format.turbo_stream do
        render turbo_stream: turbo_stream.replace(
          'brand_form',
          partial: 'form',
          locals: { brand: @brand }
        )
      end
    end
  end
end
```

### Disabling Submit Button

Prevent double submission:

```erb
<%= form_with model: [:admin, @brand] do |f| %>
  <%= f.text_field :name %>
  <%= f.submit 'Save',
      class: 'btn btn-primary',
      data: {
        controller: 'turbo-submit-button',
        turbo_submit_button_target: 'button',
        disable_with: Spree.t(:saving)
      } %>
<% end %>
```

## Modal Patterns

### Turbo Frame Modal

```erb
<!-- app/views/spree/admin/brands/index.html.erb -->
<%= link_to Spree.t(:new_brand),
    new_admin_brand_path,
    data: { turbo_frame: 'modal' },
    class: 'btn btn-primary' %>

<!-- Modal container -->
<%= turbo_frame_tag 'modal' %>

<!-- app/views/layouts/spree/admin/application.html.erb -->
<div id="modal-container">
  <%= turbo_frame_tag 'modal' %>
</div>
```

```erb
<!-- app/views/spree/admin/brands/new.html.erb -->
<%= turbo_frame_tag 'modal' do %>
  <div class="modal fade show" style="display: block;">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title"><%= Spree.t(:new_brand) %></h5>
          <%= link_to 'Ã—',
              admin_brands_path,
              class: 'close',
              data: { turbo_frame: 'modal' } %>
        </div>
        <div class="modal-body">
          <%= form_with model: [:admin, @brand] do |f| %>
            <%= render 'form', f: f %>
            <%= f.submit Spree.t(:save), class: 'btn btn-primary' %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
  <div class="modal-backdrop fade show"></div>
<% end %>
```

### Closing Modal After Success

```ruby
# Controller
def create
  @brand = Spree::Brand.new(permitted_params)

  if @brand.save
    respond_to do |format|
      format.turbo_stream do
        render turbo_stream: [
          turbo_stream.prepend('brands_list', @brand),
          turbo_stream.update('modal', ''), # Clear modal
          turbo_stream.update('flash_messages', partial: 'shared/success')
        ]
      end
    end
  else
    render :new, status: :unprocessable_entity
  end
end
```

## Search and Filtering

### Live Search

```erb
<div data-controller="search">
  <%= search_form_for @search,
      url: admin_brands_path,
      data: { search_target: 'form', turbo_frame: 'brands_list' } do |f| %>

    <%= f.text_field :name_cont,
        placeholder: Spree.t(:search),
        data: {
          search_target: 'input',
          action: 'input->search#submit'
        } %>
  <% end %>
</div>

<%= turbo_frame_tag 'brands_list' do %>
  <%= render @brands %>
<% end %>
```

```javascript
// app/javascript/controllers/search_controller.js
import { Controller } from "@hotwired/stimulus"
import { debounce } from "lodash"

export default class extends Controller {
  static targets = ["form", "input"]

  connect() {
    this.submit = debounce(this.submit.bind(this), 300)
  }

  submit() {
    this.formTarget.requestSubmit()
  }
}
```

### Filter with Turbo Frames

```erb
<div class="filters">
  <%= link_to 'All',
      admin_brands_path,
      data: { turbo_frame: 'brands_list' },
      class: 'filter-link' %>

  <%= link_to 'Active',
      admin_brands_path(q: { active_eq: true }),
      data: { turbo_frame: 'brands_list' },
      class: 'filter-link' %>

  <%= link_to 'Inactive',
      admin_brands_path(q: { active_eq: false }),
      data: { turbo_frame: 'brands_list' },
      class: 'filter-link' %>
</div>

<%= turbo_frame_tag 'brands_list' do %>
  <%= render @brands %>
  <%= paginate @brands %>
<% end %>
```

## Pagination

### Turbo Frame Pagination

```erb
<%= turbo_frame_tag 'brands_list' do %>
  <div id="brands">
    <%= render @brands %>
  </div>

  <%= paginate @brands %>
<% end %>
```

Pagination links automatically stay within the frame!

### Infinite Scroll

```erb
<div data-controller="infinite-scroll">
  <div data-infinite-scroll-target="entries">
    <%= render @brands %>
  </div>

  <% if @brands.next_page %>
    <%= turbo_frame_tag 'pagination',
        src: admin_brands_path(page: @brands.next_page),
        loading: :lazy do %>
      <div class="text-center py-3">
        <%= Spree.t(:loading_more) %>...
      </div>
    <% end %>
  <% end %>
</div>
```

## Best Practices

<Check>
  **Use Turbo Frames** for inline editing and modal workflows
</Check>

<Check>
  **Use Turbo Streams** when multiple page updates are needed
</Check>

<Check>
  **Always return proper HTTP status codes** (422 for validation errors)
</Check>

<Check>
  **Provide fallback HTML responses** for when Turbo is disabled
</Check>

<Check>
  **Use dom_id helper** for consistent element IDs
</Check>

<Check>
  **Test both Turbo and non-Turbo paths**
</Check>

<Check>
  **Clean up resources** in `turbo:before-cache` event
</Check>

## Common Issues and Solutions

### Issue: Form errors not showing

**Problem:** Form re-renders but errors aren't displayed

**Solution:** Return 422 status code
```ruby
def create
  if @brand.save
    redirect_to admin_brands_path
  else
    render :new, status: :unprocessable_entity
  end
end
```

### Issue: Turbo Frame not found

**Problem:** `Content missing` error in console

**Solution:** Ensure matching frame IDs
```erb
<!-- Both views need matching frame IDs -->
<%= turbo_frame_tag dom_id(@brand) do %>
  <!-- content -->
<% end %>
```

### Issue: JavaScript not running after Turbo navigation

**Problem:** Event listeners lost after navigation

**Solution:** Use Stimulus controllers or `turbo:load` event
```javascript
document.addEventListener('turbo:load', () => {
  // Initialize here
})
```

### Issue: Duplicate entries after form submission

**Problem:** Form submitted multiple times

**Solution:** Disable submit button
```erb
<%= f.submit 'Save',
    data: {
      controller: 'turbo-submit-button',
      turbo_submit_button_target: 'button'
    } %>
```

## See Also

- [Turbo Handbook](https://turbo.hotwired.dev/) - Official Turbo documentation
- [Stimulus Controllers](/developer/admin/stimulus-controllers) - JavaScript controllers reference
- [Common Patterns](/developer/admin/common-patterns) - Reusable admin patterns
- [Building Resources](/developer/admin/building-resources) - Complete resource guide
