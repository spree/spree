h2. REST API

This guide covers the inner working of Spree's RESTful API.  It assumes a basic understanding of the principles of "REST":http://en.wikipedia.org/wiki/Representational_State_Transfer. More specifically, the guide will provide information on the following:

* The various resources available through the API
* How to make a basic API call
* Specific examples on how to access certain resources
* Tools and other suggestions for working with the API

endprologue.

h3. Overview

The REST API is designed to give developers a convenient way to access data contained within Spree.  With a standard read/write interface to store data, it is now very simple to write third party applications (ex. iPhone) that can talk to Spree.  It is also possible to build sophisticated "middleware":http://en.wikipedia.org/wiki/Middleware applications that can serve as a bridge between Spree and a warehouse or inventory system.

h3. Available Resources

INFO: The API currently only supports a limited number of resources.  The current list reflects the needs of paying clients who funded the development of the API.  The list will be expanded soon to cover additional resources.  Adding more resources is simply a matter of making the time for testing and investigating possible security implications.

Spree currently supports RESTful access to the following resources:

* Products

h3. JSON Data

Developers communicate with the Spree API using the "JSON":http://www.json.org/ data format.  Requests for data are communicated in the standard manner using the HTTP protocol.

For example, the request +GET /api/products/a-product.json+ will produce output similar to the following:

<plain>
{
  "product": {
    "id": 1,
    "name": "A product",
    "price": "19.99",
    "available_on": "2011-03-23T21:11:50Z",
    "permalink", "a-product"
  }
}
</plain>


h3. Making an API Call

h4. Authentication

You will need an authentication token to access the API. These keys can be generated on the user edit screen within the admin interface. To make a request to the API, pass a +X-Spree-Token+ header along with the request:

<shell>
curl --header "X-Spree-Token: YOUR_KEY_HERE" http://example.com/api/products.json
</shell>

The token allows the request to assume the same level of permissions as the actual user to whom the token belongs.

h4. Other Supported Formats

Currently the API supports only the "JSON":http://www.json.org/ format.

INFO: Supporting the XML format should not be difficult since Rails supports it out of the box.  Volunteers who are willing to provide a patch (and tests) for XML support are encouraged to do so.

h3. API Reference

h4. API Rules

1. All successful requests for the API will return a status of 200.
2. Successful create and update requests will result in a status of 201 and 200 respectively.
3. Both create and update requests will return Spree's representation of the data upon success.
4. If a create or update request fails, a status code of 422 will be returned, with a hash containing an "error" key, and an "errors" key. The errors value will contain all ActiveRecord validation errors encounterd when saving this record.
5. Delete requests will return status of 200, and no content.
6. Requests that list collections, such as +/api/products+ will return a limited result set back.
7. Requests that list collections can be paginated through by passing a +page+ parameter that is a number greater than 0.
8. If a resource can not be found, the API will return a status of 404.
9. Unauthorized requests will be met with a 401 response.

h4. Products

Products support the following operations:

* Index
* Show
* New
* Create
* Update
* Destroy

Product data is returned like this:

<json>
{
  "product": {
    "id": 1,
    "name": "A product",
    "price": "19.99",
    "available_on": "2011-03-23T21:11:50Z",
    "permalink", "a-product"
  }
}
</json>

h5. Listing products

Products are displayed 25 at a time through this endpoint. To retrieve these products make a request to this endpoint:

<plain>
GET /api/products.json
</plain>

This request will return the first 25 products that are active (have an +available_on+ timestamp prior to now) if the user is not an admin, or the first 25 of all products if the user is an admin.

This request can be paginated, which is done simply by passing through a +page+ parameter on the request:

<plain>
GET /api/products.json?page=1
</plain>

The page size is not currently customizable.

h5. A single product

To view the details for a single product, make a request using that product's permalink:

<plain>
GET /api/products/a-product.json
</plain>

This will return a single product's details. For the attributes contained in this output, please see the top of this section.

h5. Pre-creation of a product

To query the API to find out what attributes are required to create a product, make a request like this:

<plain>
GET /api/products/new.json
</plain>

This request will inform the client of the fields that are required, so that the API client can indicate it to the user. Along with this are also the accepted parameters that the API will use in the creation of a product.

h5. Creating a new product

NOTE: This route is only accessible by admins.

To create a new product through the API, make this request with the necessary parameters:

<plain>
POST /api/products/create.json
</plain>

For instance, a request to create a new product called "Headphones" with a price of $100 would look like this:

<plain>
POST /api/products/create.json?product[name]=Headphones&product[price]=100
</plain>

If this request succeeds, the API will return status 201.

If it fails, a 422 status will be returned, along with error data that can be used to determine what needs correcting.

h5. Updating a product

NOTE: This route is only accessible by admins.

To update a product's details, make this request with the necessary parameters:

<plain>
PUT /api/products/a-product.json
</plain>

For instance, to update a product's name, send it through like this:

<plain>
PUT /api/products/a-product.json?product[name]=Headphones
</plain>

If this request succeeds, the API will return status 200.

If it fails, a 422 status will be returned, along with error data that can be used to determine what needs correcting.

h5. Deleting a product

NOTE: This route is only accessible by admins.

To delete a product, make this request:

<plain>
DELETE /api/products/a-product.json
</plain>

The response for this request will be empty, with a 200 status.

