<div class="modal fade" id="riskAnalysis" tabindex="-1" role="dialog" aria-labelledby="riskAnalysisLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="riskAnalysisLabel"><%= Spree.t(:risk_analysis) %></h4>
      </div>
      <div class="modal-body">
        <table class="table no-margin-bottom">
          <tbody class="additional-info">
            <tr>
              <td width="40%" class="no-border-top">
                <strong><%= Spree.t(:risk_analysis) %>:</strong>
              </td>
              <td class="no-border-top">
                <span class="state label label-<%= @order.is_risky? ? "danger" : "success" %>">
                  <%= Spree.t(:not) unless @order.is_risky? %> <%= Spree.t(:risky) %>
                </span>
              </td>
            </tr>

            <tr>
              <td width="40%">
                <strong><%= Spree.t(:failed_payment_attempts) %>:</strong>
              </td>
              <td>
                <span class="label label-<%= @order.payments.failed.count > 0 ? 'void' : 'complete' %>">
                  <%= link_to "#{Spree.t 'payments_count', count: @order.payments.failed.count, default: pluralize(@order.payments.failed.count, Spree.t(:payment))}", spree.admin_order_payments_path(@order) %>
                </span>
              </td>
            </tr>

            <% if @order.payments.valid.any? %>
              <% latest_payment = @order.payments.valid.last %>
              <tr>
                <td><strong><%= Spree.t(:avs_response) %>:</strong></td>
                <td>
                  <span class="label label-<%= latest_payment.is_avs_risky? ? 'void' : 'complete' %>">
                    <% if latest_payment.is_avs_risky? %>
                      <%= "#{Spree.t(:error)}: #{avs_response_code[latest_payment.avs_response]}" %>
                    <% else %>
                      <%= Spree.t(:success) %>
                    <% end %>
                  </span>
                </td>
              </tr>

              <tr>
                <td><strong><%= Spree.t(:cvv_response) %>:</strong></td>
                <td>
                  <span class="label label-<%= latest_payment.is_cvv_risky? ? 'void' : 'complete' %>">
                    <% if latest_payment.is_cvv_risky? %>
                      <%= "#{Spree.t(:error)}: #{cvv_response_code[latest_payment.cvv_response_code]}" %>
                    <% else %>
                      <%= Spree.t(:success) %>
                    <% end %>
                  </span>
                </td>
              </tr>
            <% end %>

          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
