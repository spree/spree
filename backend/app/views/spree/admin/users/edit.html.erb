<% content_for :page_title do %>
  <%= Spree.t(:editing_user) %> <%= @user.email %>
<% end %>

<%= render :partial => 'spree/admin/users/sidebar', :locals => { :current => :account } %>
<%= render :partial => 'spree/admin/users/user_page_actions' %>

<fieldset data-hook="admin_user_edit_general_settings" class="marginb">
  <legend><%= Spree.t(:general_settings) %></legend>

  <div data-hook="admin_user_edit_form_header">
    <%= render :partial => 'spree/admin/shared/error_messages', :locals => { :target => @user } %>
  </div>

  <div data-hook="admin_user_edit_form">
    <%= form_for [:admin, @user], as: :user, url: admin_user_url(@user), method: :put do |f| %>
      <%= render :partial => 'form', :locals => { :f => f } %>

      <div data-hook="admin_user_edit_form_button">
        <%= render :partial => 'spree/admin/shared/edit_resource_links', :locals => { :collection_url => admin_users_url } %>
      </div>
    <% end %>
  </div>
</fieldset>

<fieldset data-hook="admin_user_api_key" id="admin_user_edit_api_key" class="marginb">
  <legend><%= Spree.t('access', :scope => 'api') %></legend>

  <% if @user.spree_api_key.present? %>
    <div class="form-group">
      <div id="current-api-key"><%= Spree.t('key', :scope => 'api') %>: <%= @user.spree_api_key %></div>
    </div>
    <div class="form-actions">
      <%= form_tag spree.clear_api_key_admin_user_path(@user), :method => :put do %>
        <%= button Spree.t('clear_key', :scope => 'api'), 'delete', 'submit', class: "btn-danger" %>
      <% end %>

      <span class="or"><%= Spree.t(:or)%></span>

      <%= form_tag spree.generate_api_key_admin_user_path(@user), :method => :put do %>
        <%= button Spree.t('regenerate_key', :scope => 'api'), 'save' %>
      <% end %>
    </div>

  <% else %>

    <div class="alert alert-warning"><%= Spree.t('no_key', :scope => 'api') %></div>

    <div class="form-actions">
      <%= form_tag spree.generate_api_key_admin_user_path(@user), :method => :put do %>
        <%= button Spree.t('generate_key', :scope => 'api'), 'key' %>
      <% end %>
    </div>
  <% end %>
</fieldset>

<div data-hook="admin_user_lifetime_stats">
  <legend><%= Spree.t(:lifetime_stats) %></legend>
  <table class="table table-condensed table-bordered" id="user-lifetime-stats" data-hook>
    <tr>
      <td width="30%"><%= Spree.t(:total_sales) %>:</td>
      <td><%= @user.display_lifetime_value.to_html %></td>
    </tr>
    <tr>
      <td><%= Spree.t(:num_orders) %>:</td>
      <td><%= @user.order_count.to_i %></td>
    </tr>
    <tr>
      <td><%= Spree.t(:average_order_value) %>:</td>
      <td><%= @user.display_average_order_value.to_html %></td>
    </tr>
    <tr>
      <td><%= Spree.t(:member_since) %>:</td>
      <td><%= l @user.created_at.to_date %></td>
    </tr>
  </table>
</div>
